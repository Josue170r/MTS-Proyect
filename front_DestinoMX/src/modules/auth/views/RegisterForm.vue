<template>
  <div class="min-h-screen w-full flex flex-col md:flex-row">
    <div class="flex md:w-1/2 justify-center items-center bg-orange-300">
      <img src="@/assets/images/imagen001.jpg" alt="imagen001" />
    </div>
    <div class="md:flex flex-1 bg-white mx-8 my-8 sm:-my-0">
      <div
        class="h-flex sm:h-flex md:flex flex-col md:w-1/2 flex-1 justify-center items-center bg-gray-100 mt-32"
      >
        <img
          src="@/assets/images/DestinoMX.png"
          alt="logo"
          class="mx-auto w-64 -mt-64 sm:-mt-16 p-2 pl-8"
        />
        <Form
          @submit="onSubmit"
          class="bg-accent w-full px-5 py-5"
          :validation-schema="schema"
        >
          <p class="text-sm text-center font-normal text-gray-800 mb-7">
            Porfavor llena los siguientes campos para la creación de tu cuenta
          </p>
          <div
            class="flex items-center border-2 py-2 px-3 rounded-lg mb-4 bg-white"
          >
            <AtIcon />
            <Field
              id="username"
              v-model="user.username"
              class="pl-2 outline-none border-none w-full"
              type="username"
              name="username"
              placeholder="Correo electrónico"
            />
          </div>
          <div class="ml-1 mb-2 -mt-1">
            <ErrorMessage
              class="flex block text-red-700 text-sm"
              name="username"
            ></ErrorMessage>
          </div>
          <div
            class="flex items-center border-2 py-2 px-3 rounded-lg mb-4 bg-white"
          >
            <UserIcon />
            <Field
              id="name"
              v-model="user.name"
              class="pl-2 outline-none border-none w-full"
              type="text"
              name="name"
              placeholder="Nombre(s) *"
            />
          </div>
          <div class="ml-1 mb-2 -mt-1">
            <ErrorMessage
              class="flex block text-red-700 text-sm"
              name="name"
            ></ErrorMessage>
          </div>
          <div
            class="flex items-center border-2 py-2 px-3 rounded-lg mb-4 bg-white"
          >
            <Field
              id="lastName"
              v-model="user.lastName"
              class="pl-2 outline-none border-none w-full"
              type="text"
              name="lastName"
              placeholder="Apellido paterno *"
            />
          </div>
          <div class="ml-1 mb-2 -mt-1">
            <ErrorMessage
              class="flex block text-red-700 text-sm"
              name="lastName"
            ></ErrorMessage>
          </div>

          <div
            class="flex items-center border-2 py-2 px-3 rounded-lg mb-4 bg-white"
          >
            <Field
              id="secondLastName"
              v-model="user.secondLastName"
              class="pl-2 outline-none border-none w-full"
              type="text"
              name="secondLastName"
              placeholder="Apellido materno"
            />
          </div>
          <div class="ml-1 mb-2 -mt-1">
            <ErrorMessage
              class="flex block text-red-700 text-sm"
              name="secondLastName"
            ></ErrorMessage>
          </div>

          <div
            class="flex items-center border-2 py-2 px-3 rounded-lg mb-4 bg-white"
          >
            <PasswordIcon />
            <Field
              id="password"
              v-model="user.password"
              autocomplete="off"
              class="w-full pl-2 outline-none border-non"
              :type="showPassword ? 'text' : 'password'"
              name="password"
              placeholder="Contraseña *"
            />
          </div>
          <div class="ml-1 mb-2 -mt-1">
            <ErrorMessage
              class="flex block text-red-700 text-sm"
              name="password"
            ></ErrorMessage>
          </div>

          <div
            class="flex items-center border-2 py-2 px-3 rounded-lg mb-4 bg-white"
          >
            <PasswordIcon />
            <Field
              id="passwordConfirmation"
              v-model="user.passwordConfirmation"
              autocomplete="off"
              class="pl-2 outline-none border-none w-full"
              :type="showPassword2 ? 'text' : 'password'"
              name="passwordConfirmation"
              placeholder="Confirmar contraseña *"
            />
          </div>
          <div class="ml-1 mb-2 -mt-1">
            <ErrorMessage
              class="flex block text-red-700 text-sm"
              name="passwordConfirmation"
            ></ErrorMessage>
          </div>
          <button
            :disabled="isFormEmpty"
            type="submit"
            class="font-quicksand block w-full mt-4 py-2 rounded-lg text-white font-semibold mb-2 bg-orange-300"
            :class="[
              isFormEmpty
                ? 'opacity-60 cursor-not-allowed'
                : 'hover:outline hover:outline-1 hover:outline-orange-400',
            ]"
          >
            Crear Cuenta
          </button>
        </Form>
      </div>
    </div>
  </div>
</template>

<script>
import AtIcon from "@/components/icons/atIcon.vue"
import PasswordIcon from "@/components/icons/PasswordIcon"
import UserIcon from "@/components/icons/UserIcon"

export default {
  name: "LoginForm",
  components: {
    AtIcon,
    PasswordIcon,
    UserIcon,
    Field,
    Form,
    ErrorMessage,
  },
  data() {
    return {
      showPassword: false,
      showPassword2: false,
    }
  },
}
</script>

<script setup>
import { toRaw } from "vue"
import { reactive, computed } from "vue"
import * as yup from "yup"
import { Field, Form, ErrorMessage } from "vee-validate"

const user = reactive({
  username: "",
  name: "",
  lastName: "",
  secondLastName: "",
  password: "",
  passwordConfirmation: "",
})

const schema = yup.object({
  username: yup
    .string()
    .required("El correo electrónico es obligatorio")
    .email("Ingrese un correo electrónico válido"),
  name: yup.string().required("Este campo es obligatorio"),
  lastName: yup.string().required("Este campo es obligatorio"),
  secondLastName: yup.string().required("Este campo es obligatorio"),
  password: yup
    .string()
    .required("La contraseña es obliatoria")
    .min(8, "La contraseña debe tener al menos 8 caracteres"),
  passwordConfirmation: yup
    .string()
    .required("La confirmación de contraseña es obligatoria")
    .oneOf([yup.ref("password"), null], "Las contraseñas deben coincidir")
    .min(8, "La contraseña debe tener al menos 8 caracteres"),
})

const isFormEmpty = computed(() => {
  return !user
})

const onSubmit = async () => {
  try {
    console.log(toRaw(user))
  } catch (error) {
    console.log(error.message)
  }
}
</script>
